generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- Models ---

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  name        String?
  plan        String   @default("FREE") // FREE, ALPHA_50
  gammaCount  Int      @default(0)      // 月間生成数制限用
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // ★Jobとのリレーションは現在未使用のためコメントアウト（エラー回避）
  // jobs        Job[]
  projects    Project[]
}

model Project {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  contextData String?  @db.Text // RAG用コンテキスト
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])
  // ★Jobとのリレーションは現在未使用のためコメントアウト
  // jobs        Job[]
}

model Job {
  id           String   @id @default(uuid())
  
  // ★重要: ログイン機能未実装のため、User/Projectとの紐付けを一時的に無効化
  // userId       String
  // user         User     @relation(fields: [userId], references: [id])
  // projectId    String?
  // project      Project? @relation(fields: [projectId], references: [id])

  // --- Metadata ---
  tags         String?
  clientName   String?
  projectName  String?
  
  // --- Settings ---
  type         JobType      @default(AUDIO)
  status       JobStatus    @default(UPLOADED)
  security     SecurityMode @default(CONFIDENTIAL)

  // --- Input ---
  sourceUrl    String?
  rawText      String?  @db.Text
  fileName     String?

  // --- Outputs ---
  transcript   String?  @db.Text
  narrative    String?  @db.Text
  shieldOutput String?  @db.Text
  spearOutput  Json?
  
  // --- New Features ---
  pptOutput    String?  @db.Text // PPT下書き
  metrics      Json?             // 感情分析
  speakerMap   Json?             // 話者名マッピング
  
  // --- Others ---
  slideUrl     String?
  errorMessage String?
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// --- Enums (定義はここ1箇所に統一) ---

enum JobType {
  AUDIO
  VIDEO
  TEXT
}

enum JobStatus {
  UPLOADED
  QUEUED
  PROCESSING
  COMPLETED
  FAILED
}

enum SecurityMode {
  CONFIDENTIAL
  ANONYMOUS
}